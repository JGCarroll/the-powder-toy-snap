name: the-powder-toy
base: core20
version: '96.1'
summary: An opensource 2D physics simulation game!
description: |
  The Powder Toy is a free physics sandbox game, which simulates air pressure and velocity, heat, gravity and a countless number of interactions between different substances!
  The game provides you with various building materials, liquids, gases and electronic components which can be used to construct complex machines, guns, bombs, realistic terrains and almost anything else.
   You can then mine them and watch cool explosions, add intricate wirings, play with little stickmen or operate your machine.
  You can browse and play thousands of different saves made by the community or upload your own.

grade: stable
confinement: strict
license: GPL-3.0

parts:
  the-powder-toy:
    plugin: meson
    source: https://github.com/the-powder-toy/the-powder-toy.git
    source-type: git
    source-commit: e3c9176277c870179f782465f648d4eb94239399 # 96.1.349
    meson-parameters:
      - -Dbuildtype=release
      - -Dstatic=none
      - -Dignore_updates=true
      - -Dinstall_check=false
    build-packages:
      - cmake
      - libsdl2-dev
      - libluajit-5.1-dev
      - libcurl4-dev
      - libfftw3-dev
    stage-packages:
      - libasn1-8-heimdal
      - libcurl4
      - libfftw3-single3
      - libgssapi3-heimdal
      - libhcrypto4-heimdal
      - libheimbase1-heimdal
      - libheimntlm0-heimdal
      - libhx509-5-heimdal
      - libkrb5-26-heimdal
      - libldap-2.4-2
      - libluajit-5.1-2
      - libnghttp2-14
      - libroken18-heimdal
      - librtmp1
      - libsasl2-2
      - libsdl2-2.0-0
      - libssh-4
      - libwind0-heimdal
      - libxss1
      - libcurl3-gnutls
      - libcurl3-nss
      - libnspr4
      - libnss3

    override-build: |
      snapcraftctl build
      mkdir -p ${SNAPCRAFT_PART_INSTALL}/bin
      cp ${SNAPCRAFT_PART_BUILD}/powder ${SNAPCRAFT_PART_INSTALL}/bin/powder  

  cleanup:
    plugin: nil
    build-snaps:
      - core20
      - gnome-3-38-2004
    override-prime: |
      set -eux
      for snap in "core20" "gnome-3-38-2004"; do
          cd "/snap/$snap/current" && find . -type f,l -exec rm -f "$SNAPCRAFT_PRIME/{}" \;
      done
    after: [the-powder-toy]

layout:
  /usr/share/libdrm:
    bind: $SNAP/usr/share/libdrm

apps:
  the-powder-toy:
    command: bin/powder
    plugs:
      - desktop
      - desktop-legacy
      - network
      - x11
      - wayland
      - gsettings
      - opengl
    extensions: [gnome-3-38]
